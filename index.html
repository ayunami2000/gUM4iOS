<!DOCTYPE html5>
<html>
<head>
<title>getUserMedia Demo</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<script>
function amplifyMedia(mediaElem,multiplier){
var context=new (window.AudioContext||window.webkitAudioContext),result={context:context,source:context.createMediaElementSource(mediaElem),gain:context.createGain(),media:mediaElem,amplify:function(multiplier){result.gain.gain.value=multiplier;},getAmpLevel:function(){return result.gain.gain.value;}};
result.source.connect(result.gain);
result.gain.connect(context.destination);
result.amplify(multiplier);
return result;
}
function gUM(val,isFullParams){
navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;
navigator.mediaDevices.getUserMedia=navigator.mediaDevices.getUserMedia||navigator.mediaDevices.webkitGetUserMedia;
if(navigator.mediaDevices.getUserMedia){
navigator.mediaDevices.getUserMedia(isFullParams?val:{audio:true,video:{facingMode:val}}).then(function(stream){document.querySelector("video").srcObject=stream;}).catch(alert);
}else if(navigator.getUserMedia){
navigator.getUserMedia({audio:true,video:{facingMode:val}},function(stream){document.querySelector("video").srcObject=stream;},function(err){alert('[Deprecated gUM] '+err);});
}else{alert("getUserMedia not supported");}
}
function listDevices(){
if(navigator.mediaDevices.enumerateDevices){
document.querySelector('select').innerHTML="<optgroup label='Video Devices'><option selected>Loading video devices...</option></optgroup>";
document.querySelectorAll('select')[1].innerHTML="<option selected>Loading audio devices...</option>";
navigator.mediaDevices.enumerateDevices().then(function(devices){
document.querySelector('select').innerHTML="<optgroup label='Video Devices'>";
devices.forEach(function(device){if(device.kind.toLowerCase()=="videoinput"){document.querySelector('select').innerHTML+="<option value='"+device.deviceId+"'>"+(device.label?device.label:"A video device")+"</option>";}});
document.querySelector('select').innerHTML+="</optgroup>";
document.querySelectorAll('select')[1].innerHTML="<optgroup label='Video Devices'>";
devices.forEach(function(device){if(device.kind.toLowerCase()=="audioinput"){document.querySelectorAll('select')[1].innerHTML+="<option value='"+device.deviceId+"'>"+(device.label?device.label:"An audio device")+"</option>";}});
document.querySelectorAll('select')[1].innerHTML+="</optgroup>";
if(devices.length==0){document.querySelector('select').innerHTML="<optgroup label='Video Devices'><option selected>No video devices detected.</option></optgroup>";document.querySelectorAll('select')[1].innerHTML="<optgroup label='Audio Devices'><option selected>No audio devices detected.</option></optgroup>";}
}).catch(alert);
}else{document.querySelector('select').innerHTML=document.querySelectorAll('select')[1].innerHTML="<option selected>The MediaDevices API is not supported.</option>";}
}
</script>
</head>
<body style="text-align:center;" onload="document.querySelectorAll('input').forEach(function(el){el.checked=el.value=='other';});listDevices();">
Front Cam gUM: <input type="radio" name="selCam" value="user" onchange="gUM(this.value);this.nextElementSibling.nextElementSibling.nextElementSibling.nextElementSibling.onchange();"/><br>
Back Cam gUM: <input type="radio" name="selCam" value="environment" onchange="gUM(this.value);this.nextElementSibling.nextElementSibling.onchange();"/><br>
Other Video Capture Device: <input type="radio" name="selCam" value="other" onchange="document.querySelector('select').disabled=!this.checked;"/><br>
<button onclick="listDevices();">Refresh device list</button>
<select onchange="gUM({audio:{deviceId:{exact:this.nextElementSibling.value}},video:{deviceId:{exact:this.value}}},1);" disabled><option selected>Loading devices...</option></select>
<select onchange="gUM({audio:{deviceId:{exact:this.value}},video:{deviceId:{exact:this.previousElementSibling.value}}},1);" disabled><option selected>Loading devices...</option></select><br>
<video onloadedmetadata="this.play();amplifyMedia(this,2);" style="width:50%;display:inline-block;" playsinline></video>
</body>
</html>
